<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API - Session Replay Test</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <script src="js/tracker.js"></script>
</head>
<body data-page="api">
  <header class="top-header">
    <div class="top-header-left">
      <a href="index.html" class="header-logo">
        <div class="header-logo-icon">U</div>
        <span class="header-logo-text">uzera</span>
      </a>
      <div class="header-page-title">
        <span class="material-icons">security</span>
        <span>Session Replay Test</span>
      </div>
    </div>
    <div class="top-header-right">
      <div class="user-profile" onclick="openIdentifyModal()">
        <div class="user-avatar" id="userAvatarDisplay">TS</div>
        <span class="user-name" id="userNameDisplay">Test User</span>
        <span class="material-icons" style="font-size: 18px; color: var(--text-muted);">expand_more</span>
      </div>
    </div>
  </header>

  <nav>
    <div class="nav-links">
      <a class="nav-link" href="index.html">Home</a>
      <a class="nav-link" href="pii.html">PII</a>
      <a class="nav-link" href="auth.html">Auth</a>
      <a class="nav-link" href="financial.html">Financial</a>
      <a class="nav-link" href="sensitive.html">IDs</a>
      <a class="nav-link" href="health.html">Health</a>
      <a class="nav-link" href="inputs.html">Inputs</a>
      <a class="nav-link" href="ui.html">UI</a>
      <a class="nav-link" href="network.html">Network</a>
      <a class="nav-link" href="pages.html">Pages</a>
      <a class="nav-link" href="clicks.html">Clicks</a>
      <a class="nav-link" href="custom.html">Custom</a>
      <a class="nav-link" href="thirdparty.html">3rd Party</a>
      <a class="nav-link" href="storage.html">Storage</a>
      <a class="nav-link" href="clipboard.html">Clipboard</a>
      <a class="nav-link" href="geolocation.html">Location</a>
      <a class="nav-link" href="media.html">Media</a>
      <a class="nav-link" href="autofill.html">Autofill</a>
      <a class="nav-link" href="urldata.html">URL</a>
      <a class="nav-link" href="international.html">Intl</a>
      <a class="nav-link" href="recovery.html">2FA</a>
      <a class="nav-link" href="graphics.html">Graphics</a>
      <a class="nav-link" href="errors.html">Errors</a>
      <a class="nav-link active" href="api.html">API</a>
    </div>
  </nav>

  <div class="page">
    <h1>API Testing</h1>
    <p class="page-desc"><span class="badge-info">TESTING</span> API calls, error tracking, and performance monitoring</p>

    <div class="info-box"><p>Test various API scenarios including successful calls, errors, and performance metrics. Results are logged below each section.</p></div>

    <div class="card">
      <h3>Simulate API Calls</h3>
      <p class="text-sm text-muted" style="margin-bottom: var(--spacing-md);">Test API response masking</p>
      <div class="flex gap-05" style="flex-wrap: wrap;">
        <button class="btn btn-primary btn-sm" onclick="simulateAPICall('/api/user')">GET User (with PII)</button>
        <button class="btn btn-primary btn-sm" onclick="simulateAPICall('/api/payment')">GET Payment (with card)</button>
        <button class="btn btn-primary btn-sm" onclick="simulateAPICall('/api/auth')">GET Auth (with token)</button>
      </div>
      <p class="text-sm text-muted" style="margin: var(--spacing-md) 0 var(--spacing-sm);">Test failed API endpoints</p>
      <div class="flex gap-05" style="flex-wrap: wrap;">
        <button class="btn btn-danger btn-sm" onclick="simulateFailedAPICall('/api/user')">GET User (Failed)</button>
        <button class="btn btn-danger btn-sm" onclick="simulateFailedAPICall('/api/payment')">GET Payment (Failed)</button>
        <button class="btn btn-danger btn-sm" onclick="simulateFailedAPICall('/api/auth')">GET Auth (Failed)</button>
      </div>
      <div id="apiResponseDisplay" class="code-block mt-05" style="max-height: 150px; overflow-y: auto; display: none;"></div>
    </div>

    <div class="card">
      <h3>API Calls - Success</h3>
      <p class="text-sm text-muted" style="margin-bottom: var(--spacing-md);">Make successful API requests to public endpoints</p>
      <div class="flex gap-05" style="flex-wrap: wrap;">
        <button class="btn btn-primary btn-sm" onclick="apiGetUsers()">GET Users</button>
        <button class="btn btn-primary btn-sm" onclick="apiGetPosts()">GET Posts</button>
      </div>
      <div id="apiSuccessLog" class="code-block mt-05" style="max-height: 150px; overflow-y: auto;">Waiting for API call...</div>
    </div>

    <div class="card">
      <h3>Custom API Request</h3>
      <p class="text-sm text-muted" style="margin-bottom: var(--spacing-md);">Make a custom API request</p>
      <div class="form-group">
        <label>Method</label>
        <select id="customApiMethod" style="width: auto; display: inline-block; margin-right: var(--spacing-sm);">
          <option value="GET">GET</option>
          <option value="POST">POST</option>
          <option value="PUT">PUT</option>
          <option value="DELETE">DELETE</option>
        </select>
      </div>
      <div class="form-group">
        <label>URL</label>
        <input type="text" id="customApiUrl" placeholder="https://jsonplaceholder.typicode.com/posts/1" value="https://jsonplaceholder.typicode.com/posts/1">
      </div>
      <button class="btn btn-primary btn-sm" onclick="customApiRequest()">Send Request</button>
      <div id="customApiLog" class="code-block mt-05" style="max-height: 200px; overflow-y: auto;">Response will appear here...</div>
    </div>
  </div>

  <!-- IDENTIFY MODAL -->
  <div class="modal-overlay" id="identifyModalOverlay" onclick="closeIdentifyModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <h3 style="margin-bottom: var(--spacing-md);">Identify User</h3>
      <p class="text-sm text-muted" style="margin-bottom: var(--spacing-md);">Enter your email to identify yourself.</p>
      <form id="identifyForm" onsubmit="handleIdentifySubmit(event)">
        <div class="form-group">
          <label for="identifyName">Full Name <span style="color: var(--danger-color);">*</span></label>
          <input type="text" id="identifyName" placeholder="John Doe" required>
        </div>
        <div class="form-group">
          <label for="identifyEmail">Email Address <span style="color: var(--danger-color);">*</span></label>
          <input type="email" id="identifyEmail" placeholder="john@example.com" required>
        </div>
        <div id="generatedIdPreview" style="display: none; margin-bottom: var(--spacing-md);">
          <label class="text-sm">Generated User ID:</label>
          <div class="code-block" id="generatedIdDisplay" style="margin-top: var(--spacing-xs);"></div>
        </div>
        <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end; margin-top: var(--spacing-md);">
          <button type="button" class="btn btn-secondary btn-sm" onclick="closeIdentifyModalBtn()">Cancel</button>
          <button type="submit" class="btn btn-primary btn-sm">Identify</button>
        </div>
      </form>
      <div id="identifySuccess" style="display: none;">
        <div class="success-box"><p><strong>Successfully identified!</strong></p></div>
        <div style="margin-bottom: var(--spacing-md);"><label class="text-sm">User ID:</label><div class="code-block" id="successUserId"></div></div>
        <div style="margin-bottom: var(--spacing-md);"><label class="text-sm">Name:</label><div class="code-block" id="successName"></div></div>
        <div style="margin-bottom: var(--spacing-md);"><label class="text-sm">Email:</label><div class="code-block" id="successEmail"></div></div>
        <button type="button" class="btn btn-primary btn-sm" onclick="closeIdentifyModalBtn()" style="width: 100%;">Done</button>
      </div>
    </div>
  </div>

  <div class="toast-container" id="toastContainer"></div>
  <script src="js/main.js"></script>
  <script>
    // Simulate failed API call function
    async function simulateFailedAPICall(endpoint) {
      const display = document.getElementById('apiResponseDisplay');
      display.style.display = 'block';
      display.textContent = 'Loading...';

      // Simulate network delay
      await new Promise(resolve => setTimeout(resolve, 500));

      // Generate error responses based on endpoint
      const errorResponses = {
        '/api/user': {
          status: 404,
          error: 'Not Found',
          message: 'User not found',
          endpoint: endpoint,
          timestamp: new Date().toISOString()
        },
        '/api/payment': {
          status: 500,
          error: 'Internal Server Error',
          message: 'Payment service unavailable',
          endpoint: endpoint,
          timestamp: new Date().toISOString()
        },
        '/api/auth': {
          status: 401,
          error: 'Unauthorized',
          message: 'Invalid or expired token',
          endpoint: endpoint,
          timestamp: new Date().toISOString()
        }
      };

      const errorData = errorResponses[endpoint] || {
        status: 500,
        error: 'Unknown Error',
        message: 'An unexpected error occurred',
        endpoint: endpoint
      };

      display.style.color = 'var(--danger-color)';
      display.textContent = JSON.stringify(errorData, null, 2);
      showToast(`API Error: ${errorData.status} ${errorData.error}`, 'error');
    }

    // API functions specific to this page
    async function apiGetUsers() {
      const log = document.getElementById('apiSuccessLog');
      log.textContent = 'Loading...';
      try {
        const res = await fetch('https://jsonplaceholder.typicode.com/users?_limit=3');
        const data = await res.json();
        log.textContent = JSON.stringify(data, null, 2);
        showToast('Users loaded', 'success');
      } catch(e) {
        log.textContent = 'Error: ' + e.message;
        showToast('API Error', 'error');
      }
    }

    async function apiGetPosts() {
      const log = document.getElementById('apiSuccessLog');
      log.textContent = 'Loading...';
      try {
        const res = await fetch('https://jsonplaceholder.typicode.com/posts?_limit=3');
        const data = await res.json();
        log.textContent = JSON.stringify(data, null, 2);
        showToast('Posts loaded', 'success');
      } catch(e) {
        log.textContent = 'Error: ' + e.message;
        showToast('API Error', 'error');
      }
    }

    async function customApiRequest() {
      const method = document.getElementById('customApiMethod').value;
      const url = document.getElementById('customApiUrl').value;
      const log = document.getElementById('customApiLog');
      log.textContent = 'Loading...';
      try {
        const res = await fetch(url, { method });
        const data = await res.json();
        log.textContent = JSON.stringify(data, null, 2);
        showToast('Request successful', 'success');
      } catch(e) {
        log.textContent = 'Error: ' + e.message;
        showToast('Request failed', 'error');
      }
    }
  </script>
</body>
</html>
